services:
  auth_server:
    image: simple-oauth2-0:latest
    container_name: auth_server
    command: uvicorn auth_server:app --host 0.0.0.0 --port 8000
    ports:
      - "8000:8000"
    environment:
      CLIENT_REDIRECT_URI: "http://${IPADDR}/callback"
      CLIENT_SECRET: "demo-secret"
      JWT_SECRET: "supersecretkey"

  resource_api:
    image: simple-oauth2-0:latest
    container_name: resource_api
    command: uvicorn resource_api:app --host 0.0.0.0 --port 8001
    ports:
      - "8001:8001"
    environment:
      JWT_SECRET: "supersecretkey"

  client_app:
    image: simple-oauth2-0:latest
    container_name: client_app
    command: uvicorn client_app:app --host 0.0.0.0 --port 80
    ports:
      - "80:80"
    environment:
      CLIENT_ID: "demo-client"
      CLIENT_SECRET: "demo-secret"
      AUTH_SERVER: "http://${IPADDR}:8000"
      REDIRECT_URI: "http://${IPADDR}/callback"
      RESOURCE_URI: "http://${IPADDR}:8001/profile"
